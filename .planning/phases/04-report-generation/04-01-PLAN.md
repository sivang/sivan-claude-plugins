---
phase: 04-report-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - site-audit/skills/site-audit/references/REPORT.md
  - site-audit/skills/site-audit/SKILL.md
autonomous: true

must_haves:
  truths:
    - "A markdown report file is generated after all phases complete"
    - "Findings are grouped by type (broken links, spelling, console errors, broken resources, visual issues)"
    - "Each finding type section shows a table with individual rows"
    - "A summary counts table appears at the top"
    - "A page index at the end shows which pages had issues"
  artifacts:
    - path: "site-audit/skills/site-audit/references/REPORT.md"
      provides: "Report format specification with table structures and section templates"
      min_lines: 80
    - path: "site-audit/skills/site-audit/SKILL.md"
      provides: "Phase 5 Report implementation replacing placeholder"
      contains: "Phase 5: Report"
  key_links:
    - from: "SKILL.md Phase 5"
      to: "references/REPORT.md"
      via: "@references/REPORT.md reference"
      pattern: "@references/REPORT\\.md"
    - from: "Phase 5"
      to: ".audit-data/*.jsonl"
      via: "Read JSONL findings files"
      pattern: "findings-.*\\.jsonl"
    - from: "Phase 5"
      to: "audit-{domain}-{date}.md"
      via: "Write report to working directory"
      pattern: "audit-.*\\.md"
---

<objective>
Create the report reference document and Phase 5 implementation that reads JSONL findings and generates a structured markdown report grouped by finding type.

Purpose: Transform raw JSONL findings into a human-readable report that lets users quickly understand what issues exist on their site and where.

Output:
- references/REPORT.md with table formats, section templates, and grouping rules
- Phase 5 implementation in SKILL.md (replacing placeholder) that reads all 5 JSONL files and generates the report
</objective>

<execution_context>
@/Users/sivan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sivan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/.planning/PROJECT.md
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/.planning/ROADMAP.md
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/.planning/STATE.md

# Context decisions for this phase
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/.planning/phases/04-report-generation/04-CONTEXT.md

# Current skill file (Phase 5 placeholder to replace)
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/site-audit/skills/site-audit/SKILL.md

# Existing references (pattern to follow)
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/site-audit/skills/site-audit/references/CHECKS.md
@/Users/sivan/VitakkaProjects/sivan-claude-plugins/site-audit/skills/site-audit/references/UI_CHECKS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create REPORT.md reference document</name>
  <files>site-audit/skills/site-audit/references/REPORT.md</files>
  <action>
Create a new reference document defining the report format specification.

**Structure:**

1. **Report File Naming**
   - Filename pattern: `audit-{domain}-{date}.md`
   - Domain extracted from seed URL hostname, dots replaced with hyphens
   - Date in YYYY-MM-DD format
   - Examples: `audit-example-com-2026-01-23.md`, `audit-my-site-io-2026-01-23.md`
   - Written to working directory root (not inside .audit-data/)

2. **Report Structure Overview**
   - Ordered list of sections:
     1. Run metadata header
     2. Summary counts table
     3. Table of contents (conditional: only if 50+ findings)
     4. Finding type sections (one per type with findings)
     5. Page index

3. **Summary Counts Table**
   - Format:
     ```markdown
     ## Summary

     | Type | Errors | Warnings | Info | Total |
     |------|--------|----------|------|-------|
     | Broken Links | 3 | 0 | 0 | 3 |
     | Spelling | 0 | 5 | 0 | 5 |
     | Console Errors | 2 | 0 | 0 | 2 |
     | Broken Resources | 1 | 0 | 0 | 1 |
     | Visual Issues | 0 | 2 | 0 | 2 |
     | **Total** | **6** | **7** | **0** | **13** |
     ```
   - Only include rows for types that have findings
   - Always include the Total row

4. **Finding Type Sections**
   - One H2 section per finding type (only if that type has findings)
   - Section order: Broken Links, Spelling, Console Errors, Broken Resources, Visual Issues
   - Each section has a markdown table with type-specific columns:

   **Broken Links table:**
   ```markdown
   ## Broken Links

   | Page | Target URL | Error |
   |------|-----------|-------|
   | /about | /old-page | 404 |
   ```

   **Spelling table:**
   ```markdown
   ## Spelling Issues

   | Page | Word | Suggestion | Context |
   |------|------|------------|---------|
   | /about | occured | occurred | "...this occured during..." |
   ```
   - Context column: ~50 chars around the word, quoted

   **Console Errors table:**
   ```markdown
   ## Console Errors

   | Page | Level | Message |
   |------|-------|---------|
   | /app | error | Uncaught TypeError: Cannot read... |
   ```
   - Message truncated to 100 chars in table (full message in JSONL)

   **Broken Resources table:**
   ```markdown
   ## Broken Resources

   | Page | Resource URL | Type | Status |
   |------|-------------|------|--------|
   | /about | /images/team.jpg | image | 404 |
   ```

   **Visual Issues table:**
   ```markdown
   ## Visual Issues

   | Page | Issue | Element | Details |
   |------|-------|---------|---------|
   | /app | overflow | DIV#hero.banner | width: 1450px |
   ```

5. **Page Index**
   - H2 section at the end
   - Lists each page that had at least one finding, with count per type:
   ```markdown
   ## Page Index

   | Page | Broken Links | Spelling | Console | Resources | Visual | Total |
   |------|-------------|----------|---------|-----------|--------|-------|
   | /about | 1 | 2 | 0 | 1 | 0 | 4 |
   | /blog | 0 | 1 | 1 | 0 | 1 | 3 |
   ```
   - Only pages with findings appear
   - Sorted by total findings descending

6. **URL Display Rules**
   - In tables, show path only (strip protocol and domain) for same-domain URLs
   - Show full URL for external references
   - If path is just "/", show "/"

Document should be ~100-130 lines covering all section formats with examples.
  </action>
  <verify>
```bash
# Verify file exists
test -f site-audit/skills/site-audit/references/REPORT.md && echo "EXISTS"

# Verify key sections
grep -c "Report File Naming\|Summary Counts\|Finding Type Sections\|Page Index\|URL Display" site-audit/skills/site-audit/references/REPORT.md

# Verify table examples present
grep -c "|.*|.*|" site-audit/skills/site-audit/references/REPORT.md  # Should be 20+

# Verify all 5 finding types documented
grep -c "Broken Links\|Spelling\|Console Errors\|Broken Resources\|Visual Issues" site-audit/skills/site-audit/references/REPORT.md

# Check line count (should be 80-130 lines)
wc -l site-audit/skills/site-audit/references/REPORT.md
```
  </verify>
  <done>
REPORT.md exists with complete format specification: file naming rules, summary counts table format, all 5 finding type table structures with type-specific columns, page index format, and URL display rules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Phase 5 Report in SKILL.md</name>
  <files>site-audit/skills/site-audit/SKILL.md</files>
  <action>
Replace the "Phase 5: Report (to be implemented)" placeholder (around line 323) with full report generation implementation.

**Replace these lines:**
```
**Phase 5: Report** (to be implemented)
- Placeholder: Report that report generation is not yet implemented
- Target: Structured markdown report with findings by page and by type
```

**With this implementation:**

**Phase 5: Report**

After UI checks complete, generate the structured markdown report.

**Report Generation:**

1. **Reference rules** — Reference @references/REPORT.md for format specification

2. **Generate filename** — Derive report filename:
   - Extract hostname from seed URL
   - Replace dots with hyphens (e.g., `example.com` -> `example-com`)
   - Get current date in YYYY-MM-DD format
   - Result: `audit-{domain}-{date}.md` (e.g., `audit-example-com-2026-01-23.md`)

3. **Read all JSONL findings** — Read each findings file:
   ```bash
   cat .audit-data/findings-broken-links.jsonl 2>/dev/null
   cat .audit-data/findings-spelling.jsonl 2>/dev/null
   cat .audit-data/findings-console-errors.jsonl 2>/dev/null
   cat .audit-data/findings-broken-resources.jsonl 2>/dev/null
   cat .audit-data/findings-visual-issues.jsonl 2>/dev/null
   ```
   - Parse each line as JSON
   - Group findings by type
   - Count totals per type
   - If a file is empty or missing, that type has zero findings

4. **Build summary counts** — For each finding type, count findings by severity:
   - Broken links: all are "error"
   - Console errors: all are "error"
   - Broken resources: all are "error"
   - Spelling issues: all are "warning"
   - Visual issues: all are "warning"
   - Build the summary table (see @references/REPORT.md for format)
   - Calculate grand totals

5. **Build finding type sections** — For each type that has findings:
   - Create H2 section header
   - Build markdown table with type-specific columns (see @references/REPORT.md)
   - One row per finding
   - Strip protocol and domain from same-domain URLs (show path only)
   - Truncate long messages to 100 chars

6. **Build page index** — Aggregate findings by page URL:
   - For each unique page URL across all findings
   - Count findings per type for that page
   - Sort by total findings descending
   - Build the page index table (see @references/REPORT.md)

7. **Write report file** — Assemble and write the complete report:
   - Use the Bash tool to write the markdown file to working directory root
   - File path: `./audit-{domain}-{date}.md`
   - Report to user: report file path and total findings count

**After report generation:**
- Report file path to user
- Report total findings count and breakdown
- Note that raw JSONL data is preserved in `.audit-data/`
- Audit is complete

**Also update the "Current Status" section** at the bottom of SKILL.md to reflect all 5 phases implemented. Replace the existing status text with:

```
## Current Status

All phases are implemented. After validating the URL, the skill will:
1. Confirm the target domain
2. Initialize crawl state with BFS queue and JSONL findings files
3. Crawl up to 50 same-domain pages using WebFetch
4. For each page: detect broken links, analyze spelling/grammar, extract links
5. Write findings progressively to `.audit-data/` JSONL files
6. Open each visited page in Chrome for console errors, broken resources, and visual issues
7. Generate structured markdown report with findings grouped by type and page index
8. Write report to `audit-{domain}-{date}.md` in working directory

External link verification (Phase 3) is coming in future updates.
```

**Do not change:**
- Phases 1-4 content (URL validation, crawl, external link placeholder, UI checks)
- Any existing reference annotations
- The skill frontmatter at the top

Target: Phase 5 section should be ~50-70 lines.
  </action>
  <verify>
```bash
# Verify Phase 5 no longer placeholder
grep "Phase 5: Report" site-audit/skills/site-audit/SKILL.md | grep -v "to be implemented"

# Verify references REPORT.md
grep "@references/REPORT.md" site-audit/skills/site-audit/SKILL.md

# Verify reads all 5 JSONL files
grep -c "findings-.*\.jsonl" site-audit/skills/site-audit/SKILL.md  # Should be 5+

# Verify filename generation
grep "audit-.*-.*\.md" site-audit/skills/site-audit/SKILL.md

# Verify report is written to working directory root
grep -i "working directory" site-audit/skills/site-audit/SKILL.md

# Verify page index mentioned
grep -i "page index" site-audit/skills/site-audit/SKILL.md

# Verify Current Status updated
grep "Generate structured markdown report" site-audit/skills/site-audit/SKILL.md

# Check total line count (should be 370-410 lines)
wc -l site-audit/skills/site-audit/SKILL.md
```
  </verify>
  <done>
Phase 5 in SKILL.md contains full report generation: reads all 5 JSONL files, builds summary counts table, creates finding type sections with tables, builds page index, writes report to `audit-{domain}-{date}.md`. Current Status section updated to reflect all phases implemented.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Reference document exists:**
   - REPORT.md has file naming rules
   - REPORT.md has summary counts table format
   - REPORT.md has all 5 finding type table structures
   - REPORT.md has page index format
   - REPORT.md has URL display rules
   - File is 80-130 lines

2. **Phase 5 implemented:**
   - SKILL.md Phase 5 section no longer placeholder
   - References @references/REPORT.md
   - Reads all 5 JSONL findings files
   - Generates filename from seed URL domain + date
   - Builds summary counts, type sections, page index
   - Writes report to working directory root
   - Current Status updated

3. **Integration points:**
   - Phase 5 uses findings from Phase 2 (.audit-data/findings-broken-links.jsonl, findings-spelling.jsonl)
   - Phase 5 uses findings from Phase 4 (.audit-data/findings-console-errors.jsonl, findings-broken-resources.jsonl, findings-visual-issues.jsonl)
   - Report filename derives from Phase 1 seed URL
   - JSONL data preserved after report generation

4. **File structure:**
   - references/REPORT.md (new, 80-130 lines)
   - SKILL.md Phase 5 (50-70 lines added, replacing ~3 line placeholder)
   - Total SKILL.md ~370-410 lines
</verification>

<success_criteria>
**Measurable completion:**

1. REPORT.md file exists and contains:
   - File naming convention (audit-{domain}-{date}.md)
   - Summary counts table format with severity columns
   - All 5 finding type section formats with specific table columns
   - Page index format with per-type counts
   - URL display rules (path only for same-domain)
   - At least 80 lines total

2. SKILL.md Phase 5 contains:
   - Reference to @references/REPORT.md
   - Read all 5 JSONL files from .audit-data/
   - Generate report filename from seed URL domain + date
   - Build summary counts table with severity breakdown
   - Build finding type sections with markdown tables
   - Build page index sorted by total findings
   - Write report file to working directory root
   - Report completion to user

3. Skill is executable:
   - User runs /site-audit, all phases execute in order
   - After Phase 4 UI checks, Phase 5 generates the report
   - Report file appears at predictable path in working directory
   - Raw JSONL data preserved in .audit-data/
</success_criteria>

<output>
After completion, create `.planning/phases/04-report-generation/04-01-SUMMARY.md` following the standard summary template.

Include:
- Frontmatter with phase, plan, subsystem, tags, tech-stack, key-files, decisions, metrics
- What Was Built section (REPORT.md reference + Phase 5 core implementation)
- Technical Decisions (type-based primary grouping, path-only URLs, page index at end)
- Files Changed table
- Verification Results
- Next Phase Readiness (ready for 04-02 severity and metadata)
</output>
